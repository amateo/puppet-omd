<%- require 'json' -%>
<%-
  ids = Array.new
  nodes_json = Array.new
  if @nodes then
    @nodes['nodes'].each { | key, node | 
      jsonstr = "{ "
      jsonstr += "\"function\" : \"" + node['function'] + "\","
      jsonstr += "\"label\" : \"" + node['label'] + "\","
      jsonstr += "\"id\" : \"" + node['id'] + "\""
      jsonstr += " }"
      nodes_json += [ jsonstr ]

      ids = ids + [ node['id'] ] }
  end
-%>
{
   "rankDir" : "TB",
   "template" : "",
   "state_type" : "<%= @state_type %>",
   "name" : "<%= @name %>",
   "nodes" : [
      {
         "function" : "worst()",
         "create_obj" : 1,
         "label" : "<%= @name %>",
         "id" : "node1",
         "depends" : [
            <%= ids.collect { |x| "\"" + x + "\"" }.join(",\n            ") %>
         ]
      },
      <%= nodes_json.join(",\n      ") %>
   ]
}
